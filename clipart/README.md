# Video CTA Overlay Editor

Десктопное приложение на Python для наложения анимированных призывов к действию (CTA) на видео.

## Текущее состояние проекта

**Версия:** 1.0.0  
**Дата последнего обновления:** 2026-02-07  
**Статус:** Рабочий прототип — все основные функции реализованы и протестированы.

### Что реализовано (готово)

- [x] Интерфейс PyQt6 — тёмная тема, окно 1280×720, минимум 1000×600
- [x] Левый сайдбар (320 px) — библиотека элементов из `assets/` с превью
- [x] Панель свойств выбранного элемента (начало, длительность, прозрачность, масштаб, позиция, fade in/out)
- [x] Галка **«До конца видео»** — длительность автоматически = до конца видео
- [x] **Удаление фона** (chroma key) — автоматическое определение цвета фона по углам + слайдер допуска
- [x] Центральная зона — превью видео (OpenCV) с отрисовкой оверлеев через QPainter
- [x] Управление воспроизведением — play/pause, перемотка ±5 сек, слайдер, метки времени
- [x] Размещение элементов — двойной клик по библиотеке → клик по видео
- [x] Drag & drop — перетаскивание размещённых элементов мышкой
- [x] Масштабирование — угловой маркер (правый нижний)
- [x] Контекстное меню — удаление правой кнопкой
- [x] Таблица элементов внизу — подсветка активных, кнопки ✎ ✕ ↑ ↓
- [x] Рендеринг — MoviePy v2 с прогресс-баром и логом в отдельном диалоге
- [x] **GPU-кодирование (NVIDIA NVENC)** — h264_nvenc для GTX 1060, автодетект, фоллбэк на libx264
- [x] Оптимизация превью — даунскейл кадров до 960px, ограничение 24fps, пропуск кадров
- [x] GitHub выгрузка — GitPython, настройка токена и пути в диалоге
- [x] Undo/Redo — до 30 шагов (Ctrl+Z / Ctrl+Y)
- [x] Сохранение/загрузка проектов в JSON
- [x] Обработка ошибок — все операции обёрнуты в try/except
- [x] Загрузка пользовательских файлов элементов (копируются в `assets/`)

### Что можно улучшить (TODO / идеи на будущее)

- [ ] Встроенный набор ассетов (сейчас папка `assets/` пустая — нужно положить GIF/PNG вручную)
- [ ] Текстовый CTA — ввод произвольного текста с выбором шрифта, цвета, размера
- [ ] Превью аудио — сейчас звук при воспроизведении не играет (только визуальное превью)
- [ ] Таймлайн-дорожка — визуальная шкала с блоками элементов (как в видеоредакторе)
- [ ] Множественное выделение элементов (Ctrl+клик)
- [ ] Копирование элементов (Ctrl+C / Ctrl+V)
- [ ] Поворот элементов
- [ ] Анимация движения (keyframes) — элемент двигается по траектории
- [ ] Предустановленные шаблоны расположения (углы, центр, «нижняя треть»)
- [ ] Прогресс-бар рендеринга с оценкой оставшегося времени
- [ ] Пакетная обработка нескольких видео
- [ ] Экспорт в другие форматы (WebM, MOV)
- [ ] Локализация интерфейса (EN / RU переключение)

## Возможности

- Загрузка видео (MP4, AVI, MKV, MOV, WebM и др.)
- Библиотека CTA-элементов: GIF-анимации, PNG-изображения (руки, стрелки, кнопки «Подписаться», «Лайк» и т.д.)
- Загрузка пользовательских файлов элементов
- Размещение элементов на видео кликом мыши
- Drag & drop для перемещения размещённых элементов
- Масштабирование угловыми маркерами
- Настройка: время появления, длительность (+ «до конца видео»), прозрачность, масштаб, fade in/out
- Автоматическое удаление фона у GIF/PNG (chroma key по углам, настраиваемый допуск)
- Превью в реальном времени с наложением (оптимизировано: даунскейл + ограничение FPS)
- Рендеринг итогового видео (MoviePy v2, GPU NVENC или CPU libx264)
- Сохранение / загрузка проектов (.json)
- Автоматическая выгрузка на GitHub (GitPython)
- Undo / Redo (до 30 шагов)
- Тёмная тема, современный интерфейс

## Установка

```bash
# Клонировать репозиторий
git clone https://github.com/alexevil1979/clipart.git
cd clipart

# Установить зависимости
pip install -r requirements.txt
```

### Зависимости

- **PyQt6** >= 6.5.0
- **moviepy** >= 1.0.3 (установится v2)
- **opencv-python** >= 4.8.0
- **numpy** >= 1.24.0
- **Pillow** >= 10.0.0
- **gitpython** >= 3.1.30

### Требования к GPU (опционально)

Для аппаратного кодирования через NVIDIA NVENC:
- Видеокарта NVIDIA GTX 600+ (протестировано на GTX 1060 6GB)
- Установленные драйверы NVIDIA
- NVENC определяется автоматически, при отсутствии — фоллбэк на CPU

## Запуск

```bash
python main.py
```

## Структура проекта

```
clipart/
├── main.py                 # Точка входа
├── requirements.txt        # Зависимости Python
├── README.md               # Документация (этот файл)
├── .gitignore              # Исключения для git
├── assets/                 # CTA-элементы (GIF, PNG)
│   └── README_ASSETS.md    # Описание ассетов
├── outputs/                # Готовые видео после рендеринга
├── projects/               # Сохранённые проекты (.json)
├── .cursor/rules/          # Правила Cursor AI
└── app/                    # Пакет приложения
    ├── __init__.py          # Версия пакета
    ├── main_window.py       # Главное окно (компоновка, сигналы, логика)
    ├── video_preview.py     # Превью видео + оверлеи + GifCache + удаление фона
    ├── sidebar.py           # Библиотека элементов + панель свойств
    ├── elements_table.py    # Таблица наложенных элементов (внизу)
    ├── render_engine.py     # Рендеринг MoviePy v2 + GPU NVENC + удаление фона
    ├── github_upload.py     # Выгрузка на GitHub через GitPython
    ├── dialogs.py           # Диалоги (настройки GPU/GitHub, прогресс, о программе)
    ├── models.py            # OverlayElement, Project, UndoRedoManager
    └── styles.py            # QSS-стили (тёмная тема Catppuccin Mocha)
```

## Архитектура модулей

| Модуль | Назначение | Ключевые классы |
|--------|-----------|-----------------|
| `models.py` | Данные | `OverlayElement` (поля: позиция, время, масштаб, remove_bg, until_end...), `Project`, `UndoRedoManager` |
| `video_preview.py` | Превью | `VideoPreviewWidget` (OpenCV + QPainter), `GifCache` (кеш кадров + удаление фона), `PlaybackControlBar` |
| `sidebar.py` | Левая панель | `ElementLibrary` (список из assets/), `ElementProperties` (все спинбоксы/слайдеры), `SidebarWidget` |
| `elements_table.py` | Таблица | `ElementsTableWidget` (QTableWidget, кнопки ✎ ✕ ↑ ↓, подсветка активных) |
| `render_engine.py` | Рендер | `RenderWorker` (QThread), `check_nvenc_available()`, `_remove_bg_numpy()` |
| `github_upload.py` | GitHub | `GitHubUploadWorker` (QThread), `load/save_github_settings()` |
| `dialogs.py` | Диалоги | `RenderProgressDialog`, `SettingsDialog` (GPU + GitHub), `AboutDialog`, `GitHubUploadDialog` |
| `styles.py` | Оформление | `APP_STYLESHEET` (QSS, тёмная тема) |
| `main_window.py` | Оркестрация | `MainWindow` — связывает все виджеты, сигналы, undo/redo, меню |

## Содержимое папки assets/

Поместите в папку `assets/` файлы CTA-элементов. Рекомендуемый набор:

| Файл                      | Описание                                                        |
|---------------------------|-----------------------------------------------------------------|
| `hand_point_right.gif`    | Анимированная рука, указывающая вправо (→)                     |
| `hand_point_down.gif`     | Анимированная рука, указывающая вниз (↓)                       |
| `arrow_right.gif`         | Анимированная стрелка вправо                                    |
| `arrow_down.gif`          | Анимированная стрелка вниз                                      |
| `subscribe_button.png`    | Кнопка «Подписаться» (красная, YouTube-стиль)                  |
| `like_heart.gif`          | Анимированное сердце (лайк)                                     |
| `thumbs_up.gif`           | Анимированный палец вверх (лайк)                                |
| `bell_notification.gif`   | Анимированный колокольчик (уведомления)                        |
| `click_here.png`          | Надпись «Click Here» / «Нажми сюда»                            |
| `swipe_up.gif`            | Анимация свайпа вверх                                           |
| `tap_finger.gif`          | Анимация нажатия пальцем                                        |
| `circle_highlight.gif`    | Анимированный круг-подсветка                                    |

> **Примечание:** если у GIF/PNG есть непрозрачный фон — используйте функцию «Удалить фон» в свойствах элемента (чекбокс + слайдер допуска).

**Где взять:**
- [Giphy](https://giphy.com/) — поиск «pointing hand gif», «subscribe button» и т.д.
- [LottieFiles](https://lottiefiles.com/) — конвертировать Lottie в GIF
- [Flaticon](https://www.flaticon.com/) — PNG-иконки
- Создать самостоятельно в Canva, After Effects, или Figma

## Настройка GitHub

1. Откройте **Настройки** в приложении (меню → ⚙ Настройки)
2. Укажите путь к локальному клону репозитория
3. Введите GitHub Personal Access Token (с правами `repo`)
4. Создать токен: [github.com/settings/tokens](https://github.com/settings/tokens)

## Настройка GPU

1. Откройте **Настройки** в приложении
2. Поставьте галку «Использовать GPU (NVIDIA NVENC)»
3. Статус NVENC показывается сразу: ✅ доступен / ⚠️ недоступен
4. При рендеринге в логе видно, какой кодек используется

## Горячие клавиши

| Клавиша        | Действие                |
|----------------|-------------------------|
| `Ctrl+O`       | Открыть видео           |
| `Ctrl+S`       | Сохранить проект        |
| `Ctrl+Shift+O` | Открыть проект          |
| `Ctrl+Z`       | Отменить                |
| `Ctrl+Y`       | Повторить               |
| `Ctrl+Q`       | Выход                   |

## Технологии

- **PyQt6** — интерфейс (тёмная тема Catppuccin Mocha)
- **MoviePy v2** — рендеринг видео (композиция + запись)
- **OpenCV** — чтение видеокадров для превью
- **Pillow** — обработка GIF-анимаций (покадровое чтение)
- **NumPy** — работа с массивами пикселей, удаление фона (chroma key)
- **GitPython** — интеграция с GitHub (add, commit, push)
- **NVIDIA NVENC** — аппаратное кодирование H.264 (через ffmpeg)

## Лицензия

MIT
